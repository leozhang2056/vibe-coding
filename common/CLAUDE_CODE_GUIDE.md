# CLAUDE_CODE_GUIDE - Claude Code 完整约束指南

> 基于 Anthropic 官方文档整理

## Claude Code 核心能力

Claude Code 是一个**代理式编程工具**，可以：
- **读取代码库** - 理解整个项目结构
- **编辑文件** - 修改代码、创建新文件
- **运行命令** - 执行终端命令
- **工具集成** - 与 Git、编辑器、CI/CD 集成
- **跨文件操作** - 同时处理多个文件
- **长上下文** - 200K tokens 上下文窗口

---

## CLAUDE.md 文件的作用

在项目根目录添加 `CLAUDE.md` 文件，Claude Code 会在每次会话开始时读取它。

**用于设置：**
- 编码标准
- 架构决策
- 首选库
- 审查清单
- 项目约定

---

## CLAUDE.md 模板

```markdown
# 项目说明

这是一个 [简短描述] 项目，使用 [技术栈]。

## 项目结构

```
项目目录说明：
- src/ - 源代码
- tests/ - 测试
- docs/ - 文档
```

## 编码规范

1. **语言规范**
   - Python: 遵循 PEP 8
   - JavaScript: 使用 ES6+
   - Go: 遵循官方规范

2. **命名规范**
   - 变量/函数: snake_case
   - 类: PascalCase
   - 常量: UPPER_SNAKE_CASE

3. **文件组织**
   - 每个文件职责单一
   - 相关功能放一起
   - 避免深层嵌套

## 架构原则

1. **分层架构**
   - 展示层
   - 业务逻辑层
   - 数据访问层

2. **依赖规则**
   - 高层不依赖低层
   - 依赖抽象而非具体

3. **设计模式**
   - 优先组合而非继承
   - 使用工厂模式创建对象
   - 使用策略模式实现算法

## 首选库

1. **Python**
   - Web: Flask, FastAPI
   - 数据验证: Pydantic
   - 测试: pytest

2. **JavaScript**
   - 框架: React, Next.js
   - 状态: Zustand, Jotai
   - 工具: Vite, ESLint

## 安全要求

1. **输入验证**
   - 所有用户输入必须验证
   - 使用 Pydantic/TypeScript 类型检查

2. **认证授权**
   - 使用 JWT/Session 认证
   - 密码使用 bcrypt 加密

3. **数据保护**
   - 敏感数据加密存储
   - SQL 注入防护（使用 ORM）

## 测试要求

1. **单元测试**
   - 每个函数都要有测试
   - 使用 pytest/Jest

2. **覆盖率**
   - 核心逻辑覆盖率 > 80%
   - 分支覆盖率 > 70%

## 提交规范

1. **Commit Message**
   - feat: 新功能
   - fix: 修复 bug
   - docs: 文档更新
   - refactor: 重构
   - test: 测试
   - chore: 构建/工具更新

2. **PR 描述**
   - 说明变更内容
   - 关联 Issue
   - 测试步骤

## 常见任务

### 添加新功能

```
遵循以下步骤：
1. 在 src/ 中创建模块
2. 在 tests/ 中添加测试
3. 更新 docs/ 中的文档
4. 运行测试确保通过
```

### 修复 Bug

```
1. 定位问题
2. 编写复现用例
3. 修复问题
4. 添加测试防止回归
```

## 工作流程

1. 创建功能分支
2. 开发并测试
3. 提交 PR
4. Code Review
5. 合并到主分支
```

## 禁止事项

- 不要硬编码密钥和密码
- 不要跳过测试
- 不要提交调试代码
- 不要忽略代码审查意见
- 不要使用不维护的库
```

---

## 使用场景

### 场景 1：新功能开发

```
添加用户认证功能，使用 JWT 和 Flask，
遵循项目现有架构，确保安全性和可测试性。
```

### 场景 2：Bug 修复

```
修复登录时的 500 错误，已确认问题在 auth service 中，
请添加错误处理并更新测试。
```

### 场景 3：代码审查

```
审查以下 PR 的代码质量、安全性和性能：
[PR 链接或代码]

检查清单：
- 代码规范
- 安全漏洞
- 性能问题
- 测试覆盖
```

---

## Claude Code 特有功能

### 1. 自定义指令（Slash Commands）

```bash
# 创建自定义指令
/review       # 查看项目概览
/test        # 运行测试
/review-pr    # 审查 PR
/deploy      # 部署到测试环境
```

### 2. 钩子（Hooks）

```bash
# 编辑文件后自动格式化
pre-commit: auto-format

# 提交前运行测试
pre-commit: run-tests

# 文件保存时运行 linter
on-save: lint
```

### 3. 子代理（Sub-Agents）

```
启动多个子代理并行处理：
- 代理 1：处理 UI
- 代理 2：处理 API
- 代理 3：处理数据库

主代理协调工作并合并结果。
```

---

## 最佳实践

### 1. 明确上下文

```
✅ 好的提示：
"我正在开发用户认证功能，现有代码在 src/auth/ 中，
请添加密码重置功能，遵循现有架构。"

❌ 不好的提示：
"添加密码重置功能。"
```

### 2. 渐进式开发

```
第 1 步：创建基础接口
第 2 步：添加邮件发送
第 3 步：添加验证码
第 4 步：添加测试
```

### 3. 验证结果

```
每次修改后：
1. 运行测试
2. 检查日志
3. 手动测试关键流程
4. 确认无副作用
```

---

## AI 编码检查清单

使用 Claude Code 时，确保：

- [ ] 提示词包含项目上下文
- [ ] 明确指定编码规范
- [ ] 要求包含测试
- [ ] 考虑安全性
- [ ] 验证功能完整性
- [ ] 检查代码质量
- [ ] 遵循项目约定
- [ ] 运行测试验证
